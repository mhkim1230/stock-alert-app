<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“± MY ì¦ê¶Œ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f8f9fa;
            color: #1a1a1a;
            line-height: 1.5;
        }
        
        .app-container { 
            max-width: 428px; 
            margin: 0 auto; 
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .top-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px 20px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .top-bar h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .top-bar p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .tab-nav {
            background: white;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            position: sticky;
            top: 89px;
            z-index: 99;
        }
        
        .tab-btn {
            flex: 1;
            padding: 16px 8px;
            background: none;
            border: none;
            font-size: 0.9rem;
            font-weight: 500;
            color: #8e8e93;
            cursor: pointer;
            position: relative;
        }
        
        .tab-btn.active {
            color: #667eea;
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            padding-bottom: 100px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .add-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .add-btn:hover {
            background: #5a67d8;
        }
        
        .stock-card, .alert-card, .news-card {
            background: white;
            border: 1px solid #f1f3f4;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }
        
        .stock-card:hover, .alert-card:hover, .news-card:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .stock-info h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 2px;
        }
        
        .stock-info p {
            font-size: 0.8rem;
            color: #8e8e93;
        }
        
        .stock-price {
            text-align: right;
        }
        
        .price {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a1a1a;
        }
        
        .change {
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 2px;
        }
        
        .positive { color: #ff6b35; }
        .negative { color: #3182f6; }
        
        .stock-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid #f8f9fa;
        }
        
        .alert-status {
            font-size: 0.75rem;
            color: #8e8e93;
        }
        
        .alert-active {
            color: #ff6b35;
            font-weight: 500;
        }
        
        .action-btns {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            background: #f8f9fa;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.75rem;
            color: #6c757d;
            cursor: pointer;
        }
        
        .btn-small:hover {
            background: #e9ecef;
        }
        
        .btn-alert {
            background: #fff5f5;
            color: #ff6b35;
        }
        
        .btn-alert:hover {
            background: #fee2e2;
        }
        
        /* ì•Œë¦¼ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .alert-card {
            border-left: 4px solid #667eea;
        }
        
        .alert-card h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .alert-condition {
            font-size: 0.8rem;
            color: #667eea;
            margin-bottom: 4px;
        }
        
        .alert-time {
            font-size: 0.7rem;
            color: #8e8e93;
        }
        
        /* ë‰´ìŠ¤ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .news-card {
            cursor: pointer;
        }
        
        .news-header {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .news-image {
            width: 60px;
            height: 60px;
            background: #f1f3f4;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #8e8e93;
        }
        
        .news-content {
            flex: 1;
        }
        
        .news-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a1a1a;
            line-height: 1.4;
            margin-bottom: 4px;
        }
        
        .news-summary {
            font-size: 0.8rem;
            color: #8e8e93;
            line-height: 1.3;
            margin-bottom: 8px;
        }
        
        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem;
            color: #8e8e93;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #8e8e93;
        }
        
        .empty-state i {
            font-size: 2rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #8e8e93;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-primary {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .search-results {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-top: 8px;
        }
        
        .search-item {
            padding: 12px;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-item:hover {
            background: #f8f9fa;
        }
        
        .search-item:last-child {
            border-bottom: none;
        }
        
        .search-info h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 2px;
        }
        
        .search-info p {
            font-size: 0.8rem;
            color: #8e8e93;
        }
        
        .search-price {
            text-align: right;
            font-size: 0.8rem;
            color: #1a1a1a;
        }
        
        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a1a;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="top-bar">
            <h1>MY ì¦ê¶Œ</h1>
            <p>ë‚˜ë§Œì˜ ìŠ¤ë§ˆíŠ¸ íˆ¬ì í”Œë«í¼</p>
        </div>
        
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('portfolio')">
                <i class="fas fa-chart-line"></i> í¬íŠ¸í´ë¦¬ì˜¤
            </button>
            <button class="tab-btn" onclick="switchTab('alerts')">
                <i class="fas fa-bell"></i> ì•Œë¦¼
            </button>
            <button class="tab-btn" onclick="switchTab('news')">
                <i class="fas fa-newspaper"></i> íˆ¬ìë‰´ìŠ¤
            </button>
        </div>
        
        <!-- í¬íŠ¸í´ë¦¬ì˜¤ íƒ­ -->
        <div id="portfolio-tab" class="tab-content active">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“ˆ ê´€ì‹¬ ì£¼ì‹</h2>
                    <button class="add-btn" onclick="openStockModal()">
                        <i class="fas fa-plus"></i> ì¶”ê°€
                    </button>
                </div>
                <div id="stock-list">
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>ê´€ì‹¬ ì£¼ì‹ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ’± ê´€ì‹¬ í™˜ìœ¨</h2>
                    <button class="add-btn" onclick="openCurrencyModal()">
                        <i class="fas fa-plus"></i> ì¶”ê°€
                    </button>
                </div>
                <div id="currency-list">
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <p>ê´€ì‹¬ í™˜ìœ¨ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì•Œë¦¼ íƒ­ -->
        <div id="alerts-tab" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ”” ì„¤ì •ëœ ì•Œë¦¼</h2>
                </div>
                <div id="alert-list">
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <p>ì„¤ì •ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <p style="font-size: 0.8rem; margin-top: 8px;">í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì•Œë¦¼ì„ ì„¤ì •í•´ë³´ì„¸ìš”</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- íˆ¬ìë‰´ìŠ¤ íƒ­ -->
        <div id="news-tab" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“° íˆ¬ì ë‰´ìŠ¤</h2>
                    <button class="add-btn" onclick="refreshNews()">
                        <i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
                <div id="news-list">
                    <!-- ë‰´ìŠ¤ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì£¼ì‹ ê²€ìƒ‰ ëª¨ë‹¬ -->
    <div id="stock-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ì£¼ì‹ ê²€ìƒ‰</h3>
                <button class="close-btn" onclick="closeStockModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">ì¢…ëª©ëª… ë˜ëŠ” ì‹¬ë³¼</label>
                <input type="text" class="form-input" id="stock-search" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì, AAPL, ì½”ì–´ìœ„ë¸Œ" onkeypress="handleEnterKey(event)">
                <div id="stock-results" class="search-results" style="display: none;"></div>
            </div>
        </div>
    </div>
    
    <!-- í™˜ìœ¨ ê²€ìƒ‰ ëª¨ë‹¬ -->
    <div id="currency-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">í™˜ìœ¨ ê²€ìƒ‰</h3>
                <button class="close-btn" onclick="closeCurrencyModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">í™˜ìœ¨ ì„ íƒ</label>
                <select class="form-select" id="currency-select">
                    <option value="">í™˜ìœ¨ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="USD/KRW">USD/KRW (ë‹¬ëŸ¬/ì›)</option>
                    <option value="EUR/KRW">EUR/KRW (ìœ ë¡œ/ì›)</option>
                    <option value="JPY/KRW">JPY/KRW (ì—”/ì›)</option>
                    <option value="GBP/KRW">GBP/KRW (íŒŒìš´ë“œ/ì›)</option>
                    <option value="CNY/KRW">CNY/KRW (ìœ„ì•ˆ/ì›)</option>
                </select>
            </div>
            <button class="btn-primary" onclick="addSelectedCurrency()">í™˜ìœ¨ ì¶”ê°€</button>
        </div>
    </div>
    
    <!-- ì•Œë¦¼ ì„¤ì • ëª¨ë‹¬ -->
    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ì•Œë¦¼ ì„¤ì •</h3>
                <button class="close-btn" onclick="closeAlertModal()">&times;</button>
            </div>
            <div id="alert-form">
                <!-- ì•Œë¦¼ ì„¤ì • í¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>
    
    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="toast"></div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let watchlistStocks = JSON.parse(localStorage.getItem('watchlistStocks') || '[]');
        let watchlistCurrencies = JSON.parse(localStorage.getItem('watchlistCurrencies') || '[]');
        let alerts = JSON.parse(localStorage.getItem('alerts') || '[]');
        let currentAlertItem = null;
        
        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
            if (tabName === 'portfolio') {
                loadWatchlist();
            } else if (tabName === 'alerts') {
                loadAlerts();
            } else if (tabName === 'news') {
                loadNews();
            }
        }
        
        // ê´€ì‹¬ì¢…ëª© ë¡œë“œ
        function loadWatchlist() {
            loadStockWatchlist();
            loadCurrencyWatchlist();
            
            // ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸ (5ì´ˆë§ˆë‹¤)
            setTimeout(updateWatchlistPrices, 5000);
        }
        
        // ê´€ì‹¬ì¢…ëª© ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸
        async function updateWatchlistPrices() {
            // ì£¼ì‹ ê°€ê²© ì—…ë°ì´íŠ¸
            for (let i = 0; i < watchlistStocks.length; i++) {
                try {
                    const response = await fetch(`http://localhost:8001/naver/stocks/search/${encodeURIComponent(watchlistStocks[i].symbol)}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.results && data.results.length > 0) {
                            const updatedStock = data.results[0];
                            watchlistStocks[i].current_price = updatedStock.current_price;
                            watchlistStocks[i].change_percent = updatedStock.change_percent;
                        }
                    }
                } catch (error) {
                    console.log(`ì£¼ì‹ ${watchlistStocks[i].symbol} ê°€ê²© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`, error);
                }
            }
            
            // í™˜ìœ¨ ê°€ê²© ì—…ë°ì´íŠ¸ - ì‹¤ì œ ë„¤ì´ë²„ íŒŒì‹±ë§Œ ì‚¬ìš©
            for (let i = 0; i < watchlistCurrencies.length; i++) {
                try {
                    const response = await fetch(`http://localhost:8001/naver/currency/rate/${watchlistCurrencies[i].symbol}/KRW`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.rate) {
                            // ì‹¤ì œ ë„¤ì´ë²„ íŒŒì‹± ë°ì´í„°ë§Œ ì‚¬ìš©
                            watchlistCurrencies[i].current_rate = data.rate;
                            // ë³€ë™ë¥ ì€ ì´ì „ ê°’ê³¼ ë¹„êµí•´ì„œ ê³„ì‚° (ì‹¤ì œ ë°©ì‹)
                        }
                    }
                } catch (error) {
                    console.log(`í™˜ìœ¨ ${watchlistCurrencies[i].symbol} ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`, error);
                    // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê°€ì§œ ë°ì´í„° ì‚¬ìš© ê¸ˆì§€ - ê¸°ì¡´ ê°’ ìœ ì§€ë§Œ
                }
            }
            
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
            localStorage.setItem('watchlistStocks', JSON.stringify(watchlistStocks));
            localStorage.setItem('watchlistCurrencies', JSON.stringify(watchlistCurrencies));
            
            // UI ë‹¤ì‹œ ë¡œë“œ
            loadStockWatchlist();
            loadCurrencyWatchlist();
            
            // 5ì´ˆ í›„ ë‹¤ì‹œ ì—…ë°ì´íŠ¸
            setTimeout(updateWatchlistPrices, 5000);
        }
        
        function loadStockWatchlist() {
            const container = document.getElementById('stock-list');
            
            if (watchlistStocks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>ê´€ì‹¬ ì£¼ì‹ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = watchlistStocks.map(stock => {
                const stockAlerts = alerts.filter(a => a.symbol === stock.symbol && a.type === 'stock');
                const alertText = stockAlerts.length > 0 
                    ? `${stockAlerts.length}ê°œ ì•Œë¦¼: ${stockAlerts.map(a => `${a.condition === 'above' ? '+' : '-'}${a.value}%`).join(', ')}`
                    : 'ì•Œë¦¼ ì—†ìŒ';
                
                return `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-info">
                                <h3>${stock.name_kr || stock.name}</h3>
                                <p>${stock.symbol} â€¢ ${stock.market || 'KOSPI'}</p>
                            </div>
                            <div class="stock-price">
                                <div class="price">${formatPrice(stock.current_price)}</div>
                                <div class="change ${stock.change_percent >= 0 ? 'positive' : 'negative'}">
                                    ${stock.change_percent >= 0 ? '+' : ''}${stock.change_percent.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        <div class="stock-actions">
                            <div class="alert-status ${stockAlerts.length > 0 ? 'alert-active' : ''}">${alertText}</div>
                            <div class="action-btns">
                                <button class="btn-small btn-alert" onclick="openAlertModal('${stock.symbol}', 'stock')">
                                    <i class="fas fa-bell"></i> ${stockAlerts.length > 0 ? 'ì•Œë¦¼ ì¶”ê°€' : 'ì•Œë¦¼ ì„¤ì •'}
                                </button>
                                <button class="btn-small" onclick="removeFromWatchlist('${stock.symbol}', 'stock')">
                                    <i class="fas fa-trash"></i> ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function loadCurrencyWatchlist() {
            const container = document.getElementById('currency-list');
            
            if (watchlistCurrencies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <p>ê´€ì‹¬ í™˜ìœ¨ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = watchlistCurrencies.map(currency => {
                const currencyAlerts = alerts.filter(a => a.symbol === currency.symbol && a.type === 'currency');
                const alertText = currencyAlerts.length > 0 
                    ? `${currencyAlerts.length}ê°œ ì•Œë¦¼: ${currencyAlerts.map(a => `${a.condition === 'above' ? 'â†‘' : 'â†“'}${a.value}ì›`).join(', ')}`
                    : 'ì•Œë¦¼ ì—†ìŒ';
                
                return `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-info">
                                <h3>${currency.name}</h3>
                                <p>${currency.symbol}</p>
                            </div>
                            <div class="stock-price">
                                <div class="price">${formatPrice(currency.current_rate)}ì›</div>
                                <div class="change ${currency.change_percent >= 0 ? 'positive' : 'negative'}">
                                    ${currency.change_percent >= 0 ? '+' : ''}${currency.change_percent.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        <div class="stock-actions">
                            <div class="alert-status ${currencyAlerts.length > 0 ? 'alert-active' : ''}">${alertText}</div>
                            <div class="action-btns">
                                <button class="btn-small btn-alert" onclick="openAlertModal('${currency.symbol}', 'currency')">
                                    <i class="fas fa-bell"></i> ${currencyAlerts.length > 0 ? 'ì•Œë¦¼ ì¶”ê°€' : 'ì•Œë¦¼ ì„¤ì •'}
                                </button>
                                <button class="btn-small" onclick="removeFromWatchlist('${currency.symbol}', 'currency')">
                                    <i class="fas fa-trash"></i> ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ì•Œë¦¼ ëª©ë¡ ë¡œë“œ
        function loadAlerts() {
            const container = document.getElementById('alert-list');
            
            if (alerts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <p>ì„¤ì •ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <p style="font-size: 0.8rem; margin-top: 8px;">í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì•Œë¦¼ì„ ì„¤ì •í•´ë³´ì„¸ìš”</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = alerts.map(alert => {
                const item = alert.type === 'stock' 
                    ? watchlistStocks.find(s => s.symbol === alert.symbol)
                    : watchlistCurrencies.find(c => c.symbol === alert.symbol);
                
                const conditionText = alert.type === 'stock' 
                    ? `ğŸ“ˆ ${alert.condition === 'above' ? 'ìƒìŠ¹' : 'í•˜ë½'} ${alert.value}% ë„ë‹¬ ì‹œ ì•Œë¦¼`
                    : `ğŸ’± í™˜ìœ¨ ${alert.value}ì› ${alert.condition === 'above' ? 'ì´ìƒ' : 'ì´í•˜'}ì¼ ë•Œ ì•Œë¦¼`;
                
                return `
                    <div class="alert-card">
                        <h4>${item ? (item.name_kr || item.name) : alert.symbol}</h4>
                        <div class="alert-condition">${conditionText}</div>
                        <div class="alert-time">ì„¤ì •ì¼: ${new Date(alert.created).toLocaleDateString()}</div>
                        <div style="margin-top: 12px;">
                            <button class="btn-small" onclick="removeAlert('${alert.id}')">
                                <i class="fas fa-trash"></i> ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ë‰´ìŠ¤ ë¡œë“œ
        function loadNews() {
            const container = document.getElementById('news-list');
            
            // ì‹œë®¬ë ˆì´ì…˜ ë‰´ìŠ¤ ë°ì´í„°
            const newsData = [
                {
                    title: "ì‚¼ì„±ì „ì, 3ë¶„ê¸° ì‹¤ì  ì‹œì¥ ê¸°ëŒ€ì¹˜ ìƒíšŒ",
                    summary: "ì‚¼ì„±ì „ìê°€ 3ë¶„ê¸° ì˜ì—…ì´ìµì´ ì‹œì¥ ê¸°ëŒ€ì¹˜ë¥¼ ìƒíšŒí–ˆë‹¤ê³  ë°œí‘œí–ˆìŠµë‹ˆë‹¤. ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ê°€ê²© ìƒìŠ¹ì´ ì£¼ìš” ìš”ì¸ìœ¼ë¡œ...",
                    source: "í•œêµ­ê²½ì œ",
                    time: "2ì‹œê°„ ì „",
                    icon: "fas fa-microchip"
                },
                {
                    title: "ë¯¸êµ­ ì—°ì¤€, ê¸°ì¤€ê¸ˆë¦¬ ë™ê²° ê²°ì •",
                    summary: "ë¯¸êµ­ ì—°ë°©ì¤€ë¹„ì œë„ê°€ ê¸°ì¤€ê¸ˆë¦¬ë¥¼ í˜„ ìˆ˜ì¤€ì—ì„œ ë™ê²°í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤. ì¸í”Œë ˆì´ì…˜ ë‘”í™” ì†ë„ë¥¼ ì§€ì¼œë³´ê² ë‹¤ê³ ...",
                    source: "ì—°í•©ë‰´ìŠ¤",
                    time: "4ì‹œê°„ ì „",
                    icon: "fas fa-university"
                },
                {
                    title: "í…ŒìŠ¬ë¼, ìƒˆë¡œìš´ ììœ¨ì£¼í–‰ ê¸°ìˆ  ê³µê°œ",
                    summary: "í…ŒìŠ¬ë¼ê°€ ì™„ì „ ììœ¨ì£¼í–‰ì„ ìœ„í•œ ìƒˆë¡œìš´ AI ê¸°ìˆ ì„ ê³µê°œí–ˆìŠµë‹ˆë‹¤. ì´ë²ˆ ê¸°ìˆ ë¡œ ììœ¨ì£¼í–‰ ì™„ì„±ë„ê°€ í¬ê²Œ...",
                    source: "í…Œí¬í¬ëŸ°ì¹˜",
                    time: "6ì‹œê°„ ì „",
                    icon: "fas fa-car"
                },
                {
                    title: "ë¹„íŠ¸ì½”ì¸, 4ë§Œ ë‹¬ëŸ¬ ëŒíŒŒ",
                    summary: "ë¹„íŠ¸ì½”ì¸ì´ ë‹¤ì‹œ 4ë§Œ ë‹¬ëŸ¬ë¥¼ ëŒíŒŒí•˜ë©° ìƒìŠ¹ì„¸ë¥¼ ì´ì–´ê°€ê³  ìˆìŠµë‹ˆë‹¤. ê¸°ê´€ íˆ¬ììë“¤ì˜ ê´€ì‹¬ì´ ë†’ì•„ì§€ë©´ì„œ...",
                    source: "ì½”ì¸ë°ìŠ¤í¬",
                    time: "8ì‹œê°„ ì „",
                    icon: "fab fa-bitcoin"
                },
                {
                    title: "ì• í”Œ, ìƒˆë¡œìš´ iPhone 15 ì‹œë¦¬ì¦ˆ ì¶œì‹œ",
                    summary: "ì• í”Œì´ iPhone 15 ì‹œë¦¬ì¦ˆë¥¼ ê³µì‹ ì¶œì‹œí–ˆìŠµë‹ˆë‹¤. USB-C í¬íŠ¸ ì±„íƒê³¼ í•¨ê»˜ ì¹´ë©”ë¼ ì„±ëŠ¥ì´ ëŒ€í­ í–¥ìƒë˜ì—ˆë‹¤ê³ ...",
                    source: "ë§¤í¬ë£¨ë¨¸ìŠ¤",
                    time: "12ì‹œê°„ ì „",
                    icon: "fab fa-apple"
                }
            ];
            
            container.innerHTML = newsData.map(news => `
                <div class="news-card" onclick="openNews('${news.title}')">
                    <div class="news-header">
                        <div class="news-image">
                            <i class="${news.icon}"></i>
                        </div>
                        <div class="news-content">
                            <div class="news-title">${news.title}</div>
                            <div class="news-summary">${news.summary}</div>
                            <div class="news-meta">
                                <span>${news.source}</span>
                                <span>${news.time}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // ë‰´ìŠ¤ ìƒˆë¡œê³ ì¹¨
        function refreshNews() {
            showToast('ë‰´ìŠ¤ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤');
            loadNews();
        }
        
        // ë‰´ìŠ¤ ì—´ê¸°
        function openNews(title) {
            showToast(`ë‰´ìŠ¤ ì—´ê¸°: ${title}`);
        }
        
        // ì£¼ì‹ ê²€ìƒ‰ ëª¨ë‹¬
        function openStockModal() {
            document.getElementById('stock-modal').style.display = 'block';
            document.getElementById('stock-search').focus();
        }
        
        function closeStockModal() {
            document.getElementById('stock-modal').style.display = 'none';
            document.getElementById('stock-search').value = '';
            document.getElementById('stock-results').style.display = 'none';
        }
        
        // í™˜ìœ¨ ê²€ìƒ‰ ëª¨ë‹¬
        function openCurrencyModal() {
            document.getElementById('currency-modal').style.display = 'block';
        }
        
        function closeCurrencyModal() {
            document.getElementById('currency-modal').style.display = 'none';
            document.getElementById('currency-select').value = '';
        }
        
        // ì•Œë¦¼ ì„¤ì • ëª¨ë‹¬
        function openAlertModal(symbol, type) {
            currentAlertItem = { symbol, type };
            
            const item = type === 'stock' 
                ? watchlistStocks.find(s => s.symbol === symbol)
                : watchlistCurrencies.find(c => c.symbol === symbol);
            
            const formHtml = type === 'stock' ? `
                <div class="form-group">
                    <label class="form-label">ğŸ“ˆ ${item.name_kr || item.name} ì£¼ì‹ ì•Œë¦¼</label>
                    <p style="color: #666; font-size: 12px; margin: 5px 0;">ì£¼ì‹ ê°€ê²© ë³€ë™ë¥  ê¸°ì¤€ìœ¼ë¡œ ì•Œë¦¼ì„ ì„¤ì •í•©ë‹ˆë‹¤</p>
                </div>
                <div class="form-group">
                    <label class="form-label">ì•Œë¦¼ ì¡°ê±´</label>
                    <select class="form-select" id="alert-condition">
                        <option value="above">ğŸ“ˆ ìƒìŠ¹ (ì§€ì •í•œ % ì´ìƒ ì˜¤ë¥¼ ë•Œ)</option>
                        <option value="below">ğŸ“‰ í•˜ë½ (ì§€ì •í•œ % ì´ìƒ ë–¨ì–´ì§ˆ ë•Œ)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ë³€ë™ë¥  (%)</label>
                    <input type="number" class="form-input" id="alert-value" placeholder="ì˜ˆ: 5 (5% ë³€ë™ ì‹œ ì•Œë¦¼)" step="0.1" min="0.1">
                    <small style="color: #666;">í˜„ì¬ê°€ ëŒ€ë¹„ ë³€ë™ë¥ ì„ ì…ë ¥í•˜ì„¸ìš”</small>
                </div>
                <button class="btn-primary" onclick="saveAlert()">ğŸ“± ì£¼ì‹ ì•Œë¦¼ ì„¤ì •</button>
            ` : `
                <div class="form-group">
                    <label class="form-label">ğŸ’± ${item.name} í™˜ìœ¨ ì•Œë¦¼</label>
                    <p style="color: #666; font-size: 12px; margin: 5px 0;">íŠ¹ì • í™˜ìœ¨ ê°€ê²©ì— ë„ë‹¬í•˜ë©´ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤</p>
                </div>
                <div class="form-group">
                    <label class="form-label">ì•Œë¦¼ ì¡°ê±´</label>
                    <select class="form-select" id="alert-condition">
                        <option value="above">â¬†ï¸ í™˜ìœ¨ì´ ì§€ì • ê°€ê²© ì´ìƒì¼ ë•Œ</option>
                        <option value="below">â¬‡ï¸ í™˜ìœ¨ì´ ì§€ì • ê°€ê²© ì´í•˜ì¼ ë•Œ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ¯ ëª©í‘œ í™˜ìœ¨ (ì›)</label>
                    <input type="number" class="form-input" id="alert-value" placeholder="ì˜ˆ: 1300 (1ë‹¬ëŸ¬ = 1300ì› ì‹œ ì•Œë¦¼)" step="1" min="1">
                    <small style="color: #666;">ì›í•˜ëŠ” í™˜ìœ¨ ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: USD/KRW 1300ì›)</small>
                </div>
                <button class="btn-primary" onclick="saveAlert()">ğŸ“± í™˜ìœ¨ ì•Œë¦¼ ì„¤ì •</button>
            `;
            
            document.getElementById('alert-form').innerHTML = formHtml;
            document.getElementById('alert-modal').style.display = 'block';
        }
        
        function closeAlertModal() {
            document.getElementById('alert-modal').style.display = 'none';
            currentAlertItem = null;
        }
        
        // ì•Œë¦¼ ì €ì¥
        function saveAlert() {
            const condition = document.getElementById('alert-condition').value;
            const value = parseFloat(document.getElementById('alert-value').value);
            
            if (!value || value <= 0) {
                showToast('ì˜¬ë°”ë¥¸ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            // ì™„ì „íˆ ë™ì¼í•œ ì•Œë¦¼ë§Œ ì¤‘ë³µ ë°©ì§€ (ê°™ì€ ì¢…ëª©, ê°™ì€ ì¡°ê±´, ê°™ì€ ê°’)
            const existingAlert = alerts.find(a => 
                a.symbol === currentAlertItem.symbol && 
                a.type === currentAlertItem.type && 
                a.condition === condition && 
                a.value === value
            );
            
            if (existingAlert) {
                showToast('ë™ì¼í•œ ì¡°ê±´ì˜ ì•Œë¦¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤');
                return;
            }
            
            // ìƒˆ ì•Œë¦¼ ì¶”ê°€
            const newAlert = {
                id: Date.now().toString(),
                symbol: currentAlertItem.symbol,
                type: currentAlertItem.type,
                condition: condition,
                value: value,
                created: new Date().toISOString()
            };
            
            alerts.push(newAlert);
            localStorage.setItem('alerts', JSON.stringify(alerts));
            
            const alertMessage = currentAlertItem.type === 'stock' 
                ? `ğŸ“ˆ ì£¼ì‹ ì•Œë¦¼ ì¶”ê°€ì™„ë£Œ: ${condition === 'above' ? '+' : condition === 'below' ? '-' : ''}${value}% ë³€ë™ ì‹œ ì•Œë¦¼`
                : `ğŸ’± í™˜ìœ¨ ì•Œë¦¼ ì¶”ê°€ì™„ë£Œ: ${value}ì› ë„ë‹¬ ì‹œ ì•Œë¦¼`;
            
            showToast(alertMessage);
            closeAlertModal();
            loadWatchlist();
        }
        
        // ì•Œë¦¼ ì‚­ì œ
        function removeAlert(alertId) {
            alerts = alerts.filter(a => a.id !== alertId);
            localStorage.setItem('alerts', JSON.stringify(alerts));
            showToast('ì•Œë¦¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            loadAlerts();
            loadWatchlist();
        }
        
        // ì—”í„°í‚¤ ì²˜ë¦¬
        function handleEnterKey(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault();
                const query = document.getElementById('stock-search').value.trim();
                if (query.length > 0) {
                    showToast(`ğŸ” "${query}" ê²€ìƒ‰ ì¤‘...`);
                    searchStocks();
                }
            }
        }

        // ì£¼ì‹ ê²€ìƒ‰ (ì‹¤ì œ API í˜¸ì¶œ)
        async function searchStocks() {
            const query = document.getElementById('stock-search').value.trim();
            const resultsContainer = document.getElementById('stock-results');
            
            if (query.length < 1) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            // ë¡œë”© í‘œì‹œ
            resultsContainer.innerHTML = '<div class="search-item">ğŸ” ê²€ìƒ‰ ì¤‘...</div>';
            resultsContainer.style.display = 'block';
            
            try {
                // ë„¤ì´ë²„ ì£¼ì‹ ê²€ìƒ‰ API í˜¸ì¶œ
                const response = await fetch(`http://localhost:8001/naver/stocks/search/${encodeURIComponent(query)}`);
                
                if (!response.ok) {
                    throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    resultsContainer.innerHTML = data.results.map(stock => `
                        <div class="search-item" onclick="addToWatchlist('${stock.symbol}', 'stock', ${JSON.stringify(stock).replace(/"/g, '&quot;')})">
                            <div class="search-info">
                                <h4>${stock.name_kr || stock.name}</h4>
                                <p>${stock.symbol} â€¢ ${stock.market || 'KOSPI'}</p>
                            </div>
                            <div class="search-price">
                                <div>${formatPrice(stock.current_price || 0)}</div>
                                <div class="change ${(stock.change_percent || 0) >= 0 ? 'positive' : 'negative'}">
                                    ${(stock.change_percent || 0) >= 0 ? '+' : ''}${(stock.change_percent || 0).toFixed(2)}%
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    resultsContainer.innerHTML = '<div class="search-item">âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                }
            } catch (error) {
                console.error('ì£¼ì‹ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                
                // ê°€ì§œ ë°ì´í„° ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€! íŒŒì‹± ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë§Œ í‘œì‹œ
                resultsContainer.innerHTML = `
                    <div style="padding: 15px; background: #f8d7da; color: #721c24; border-radius: 8px; text-align: center;">
                        <div style="font-size: 16px; margin-bottom: 8px;">âŒ ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨</div>
                        <div style="font-size: 12px; line-height: 1.4;">
                            ë„¤ì´ë²„ íŒŒì‹± ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                            ì •í™•í•œ ì£¼ì‹ ë°ì´í„°ë¥¼ ì œê³µí•  ìˆ˜ ì—†ì–´ ê²€ìƒ‰ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.<br>
                            ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                        </div>
                    </div>
                `;
            }
        }
        
        // ì„ íƒëœ í™˜ìœ¨ ì¶”ê°€ - ì‹¤ì œ ë„¤ì´ë²„ íŒŒì‹±ë§Œ ì‚¬ìš©
        async function addSelectedCurrency() {
            const select = document.getElementById('currency-select');
            const selectedValue = select.value;
            
            if (!selectedValue) {
                showToast('í™˜ìœ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            
            // ì‹¤ì œ ë„¤ì´ë²„ í™˜ìœ¨ íŒŒì‹±ìœ¼ë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            try {
                showToast('ì‹¤ì‹œê°„ í™˜ìœ¨ ë°ì´í„° ì¡°íšŒ ì¤‘...');
                const response = await fetch(`http://localhost:8001/naver/currency/rate/${selectedValue}/KRW`);
                
                if (!response.ok) {
                    throw new Error('í™˜ìœ¨ API í˜¸ì¶œ ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                
                if (data.rate) {
                    const currencyData = {
                        symbol: selectedValue,
                        name: select.options[select.selectedIndex].text,
                        current_rate: data.rate,
                        change_percent: 0, // ì‹¤ì œ ë³€ë™ë¥ ì€ ë‹¤ìŒ ì—…ë°ì´íŠ¸ ì‹œ ê³„ì‚°
                        source: 'naver_real_parsing'
                    };
                    
                    addToWatchlist(selectedValue, 'currency', currencyData);
                } else {
                    throw new Error('í™˜ìœ¨ ë°ì´í„° ì—†ìŒ');
                }
            } catch (error) {
                console.error('í™˜ìœ¨ ì¡°íšŒ ì˜¤ë¥˜:', error);
                showToast('âŒ ì‹¤ì‹œê°„ í™˜ìœ¨ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨ - ì •í™•í•œ ë°ì´í„°ë¥¼ ì œê³µí•  ìˆ˜ ì—†ì–´ ì¶”ê°€ë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤');
            }
        }
        
        // ê´€ì‹¬ì¢…ëª© ì¶”ê°€
        function addToWatchlist(symbol, type, data) {
            const parsedData = typeof data === 'string' ? JSON.parse(data.replace(/&quot;/g, '"')) : data;
            
            if (type === 'stock') {
                if (watchlistStocks.find(s => s.symbol === symbol)) {
                    showToast('ì´ë¯¸ ê´€ì‹¬ì¢…ëª©ì— ì¶”ê°€ëœ ì£¼ì‹ì…ë‹ˆë‹¤');
                    return;
                }
                watchlistStocks.push(parsedData);
                localStorage.setItem('watchlistStocks', JSON.stringify(watchlistStocks));
                closeStockModal();
            } else {
                if (watchlistCurrencies.find(c => c.symbol === symbol)) {
                    showToast('ì´ë¯¸ ê´€ì‹¬ì¢…ëª©ì— ì¶”ê°€ëœ í™˜ìœ¨ì…ë‹ˆë‹¤');
                    return;
                }
                watchlistCurrencies.push(parsedData);
                localStorage.setItem('watchlistCurrencies', JSON.stringify(watchlistCurrencies));
                closeCurrencyModal();
            }
            
            showToast('ê´€ì‹¬ì¢…ëª©ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
            loadWatchlist();
        }
        
        // ê´€ì‹¬ì¢…ëª© ì œê±°
        function removeFromWatchlist(symbol, type) {
            if (type === 'stock') {
                watchlistStocks = watchlistStocks.filter(s => s.symbol !== symbol);
                localStorage.setItem('watchlistStocks', JSON.stringify(watchlistStocks));
            } else {
                watchlistCurrencies = watchlistCurrencies.filter(c => c.symbol !== symbol);
                localStorage.setItem('watchlistCurrencies', JSON.stringify(watchlistCurrencies));
            }
            
            // ê´€ë ¨ ì•Œë¦¼ë„ ì œê±°
            alerts = alerts.filter(a => !(a.symbol === symbol && a.type === type));
            localStorage.setItem('alerts', JSON.stringify(alerts));
            
            showToast('ê´€ì‹¬ì¢…ëª©ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤');
            loadWatchlist();
        }
        
        // ê°€ê²© í¬ë§·íŒ…
        function formatPrice(price) {
            if (price >= 1000) {
                return price.toLocaleString();
            }
            return price.toFixed(2);
        }
        
        // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadWatchlist();
            loadNews();
        });
    </script>
</body>
</html> 