<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± MY Ï¶ùÍ∂å</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f8f9fa;
            color: #1a1a1a;
            line-height: 1.5;
        }
        
        .app-container { 
            max-width: 428px; 
            margin: 0 auto; 
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .top-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px 20px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .top-bar h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .top-bar p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .tab-nav {
            background: white;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            position: sticky;
            top: 89px;
            z-index: 99;
        }
        
        .tab-btn {
            flex: 1;
            padding: 16px 8px;
            background: none;
            border: none;
            font-size: 0.9rem;
            font-weight: 500;
            color: #8e8e93;
            cursor: pointer;
            position: relative;
        }
        
        .tab-btn.active {
            color: #667eea;
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            padding-bottom: 100px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .add-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .add-btn:hover {
            background: #5a67d8;
        }
        
        .stock-card, .alert-card, .news-card {
            background: white;
            border: 1px solid #f1f3f4;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }
        
        .stock-card:hover, .alert-card:hover, .news-card:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .stock-info h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 2px;
        }
        
        .stock-info p {
            font-size: 0.8rem;
            color: #8e8e93;
        }
        
        .stock-price {
            text-align: right;
        }
        
        .price {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a1a1a;
        }
        
        .change {
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 2px;
        }
        
        .positive { color: #ff6b35; }
        .negative { color: #3182f6; }
        
        .stock-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid #f8f9fa;
        }
        
        .alert-status {
            font-size: 0.75rem;
            color: #8e8e93;
        }
        
        .alert-active {
            color: #ff6b35;
            font-weight: 500;
        }
        
        .action-btns {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            background: #f8f9fa;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.75rem;
            color: #6c757d;
            cursor: pointer;
        }
        
        .btn-small:hover {
            background: #e9ecef;
        }
        
        .btn-alert {
            background: #fff5f5;
            color: #ff6b35;
        }
        
        .btn-alert:hover {
            background: #fee2e2;
        }
        
        /* ÏïåÎ¶º Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .alert-card {
            border-left: 4px solid #667eea;
        }
        
        .alert-card h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .alert-condition {
            font-size: 0.8rem;
            color: #667eea;
            margin-bottom: 4px;
        }
        
        .alert-time {
            font-size: 0.7rem;
            color: #8e8e93;
        }
        
        /* Îâ¥Ïä§ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .news-card {
            cursor: pointer;
        }
        
        .news-header {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .news-image {
            width: 60px;
            height: 60px;
            background: #f1f3f4;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #8e8e93;
        }
        
        .news-content {
            flex: 1;
        }
        
        .news-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a1a1a;
            line-height: 1.4;
            margin-bottom: 4px;
        }
        
        .news-summary {
            font-size: 0.8rem;
            color: #8e8e93;
            line-height: 1.3;
            margin-bottom: 8px;
        }
        
        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem;
            color: #8e8e93;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #8e8e93;
        }
        
        .empty-state i {
            font-size: 2rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #8e8e93;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-primary {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .search-results {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-top: 8px;
        }
        
        .search-item {
            padding: 12px;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-item:hover {
            background: #f8f9fa;
        }
        
        .search-item:last-child {
            border-bottom: none;
        }
        
        .search-info h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 2px;
        }
        
        .search-info p {
            font-size: 0.8rem;
            color: #8e8e93;
        }
        
        .search-price {
            text-align: right;
            font-size: 0.8rem;
            color: #1a1a1a;
        }
        
        /* ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a1a;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="top-bar">
            <h1>MY Ï¶ùÍ∂å</h1>
            <p>ÎÇòÎßåÏùò Ïä§ÎßàÌä∏ Ìà¨Ïûê ÌîåÎû´Ìèº</p>
        </div>
        
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('portfolio')">
                <i class="fas fa-chart-line"></i> Ìè¨Ìä∏Ìè¥Î¶¨Ïò§
            </button>
            <button class="tab-btn" onclick="switchTab('alerts')">
                <i class="fas fa-bell"></i> ÏïåÎ¶º
            </button>
            <button class="tab-btn" onclick="switchTab('news')">
                <i class="fas fa-newspaper"></i> Ìà¨ÏûêÎâ¥Ïä§
            </button>
        </div>
        
        <!-- Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÌÉ≠ -->
        <div id="portfolio-tab" class="tab-content active">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìà Í¥ÄÏã¨ Ï£ºÏãù</h2>
                    <button class="add-btn" onclick="openStockModal()">
                        <i class="fas fa-plus"></i> Ï∂îÍ∞Ä
                    </button>
                </div>
                <div id="stock-list">
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Í¥ÄÏã¨ Ï£ºÏãùÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üí± Í¥ÄÏã¨ ÌôòÏú®</h2>
                    <button class="add-btn" onclick="openCurrencyModal()">
                        <i class="fas fa-plus"></i> Ï∂îÍ∞Ä
                    </button>
                </div>
                <div id="currency-list">
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <p>Í¥ÄÏã¨ ÌôòÏú®ÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÏïåÎ¶º ÌÉ≠ -->
        <div id="alerts-tab" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üîî ÏÑ§Ï†ïÎêú ÏïåÎ¶º</h2>
                </div>
                <div id="alert-list">
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <p>ÏÑ§Ï†ïÎêú ÏïåÎ¶ºÏù¥ ÏóÜÏäµÎãàÎã§</p>
                        <p style="font-size: 0.8rem; margin-top: 8px;">Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ÏóêÏÑú ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌï¥Î≥¥ÏÑ∏Ïöî</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ìà¨ÏûêÎâ¥Ïä§ ÌÉ≠ -->
        <div id="news-tab" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üì∞ Ìà¨Ïûê Îâ¥Ïä§</h2>
                    <button class="add-btn" onclick="refreshNews()">
                        <i class="fas fa-sync-alt"></i> ÏÉàÎ°úÍ≥†Ïπ®
                    </button>
                </div>
                <div id="news-list">
                    <!-- Îâ¥Ïä§ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê Î°úÎìúÎê©ÎãàÎã§ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ï£ºÏãù Í≤ÄÏÉâ Î™®Îã¨ -->
    <div id="stock-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ï£ºÏãù Í≤ÄÏÉâ</h3>
                <button class="close-btn" onclick="closeStockModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Ï¢ÖÎ™©Î™Ö ÎòêÎäî Ïã¨Î≥º</label>
                <input type="text" class="form-input" id="stock-search" placeholder="Ïòà: ÏÇºÏÑ±Ï†ÑÏûê, AAPL, ÏΩîÏñ¥ÏúÑÎ∏å" onkeypress="handleEnterKey(event)">
                <div id="stock-results" class="search-results" style="display: none;"></div>
            </div>
        </div>
    </div>
    
    <!-- ÌôòÏú® Í≤ÄÏÉâ Î™®Îã¨ -->
    <div id="currency-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÌôòÏú® Í≤ÄÏÉâ</h3>
                <button class="close-btn" onclick="closeCurrencyModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">ÌôòÏú® ÏÑ†ÌÉù</label>
                <select class="form-select" id="currency-select">
                    <option value="">ÌôòÏú®ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                    <option value="USD/KRW">USD/KRW (Îã¨Îü¨/Ïõê)</option>
                    <option value="EUR/KRW">EUR/KRW (Ïú†Î°ú/Ïõê)</option>
                    <option value="JPY/KRW">JPY/KRW (Ïóî/Ïõê)</option>
                    <option value="GBP/KRW">GBP/KRW (ÌååÏö¥Îìú/Ïõê)</option>
                    <option value="CNY/KRW">CNY/KRW (ÏúÑÏïà/Ïõê)</option>
                </select>
            </div>
            <button class="btn-primary" onclick="addSelectedCurrency()">ÌôòÏú® Ï∂îÍ∞Ä</button>
        </div>
    </div>
    
    <!-- ÏïåÎ¶º ÏÑ§Ï†ï Î™®Îã¨ -->
    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÏïåÎ¶º ÏÑ§Ï†ï</h3>
                <button class="close-btn" onclick="closeAlertModal()">&times;</button>
            </div>
            <div id="alert-form">
                <!-- ÏïåÎ¶º ÏÑ§Ï†ï ÌèºÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </div>
        </div>
    </div>
    
    <!-- ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º -->
    <div id="toast" class="toast"></div>
    
    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let watchlistStocks = JSON.parse(localStorage.getItem('watchlistStocks') || '[]');
        let watchlistCurrencies = JSON.parse(localStorage.getItem('watchlistCurrencies') || '[]');
        let alerts = JSON.parse(localStorage.getItem('alerts') || '[]');
        let currentAlertItem = null;
        
        // ÌÉ≠ Ï†ÑÌôò
        function switchTab(tabName) {
            // Î™®Îì† ÌÉ≠ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // ÌÉ≠Î≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            if (tabName === 'portfolio') {
                loadWatchlist();
            } else if (tabName === 'alerts') {
                loadAlerts();
            } else if (tabName === 'news') {
                loadNews();
            }
        }
        
        // Í¥ÄÏã¨Ï¢ÖÎ™© Î°úÎìú
        function loadWatchlist() {
            loadStockWatchlist();
            loadCurrencyWatchlist();
            
            // Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏ (5Ï¥àÎßàÎã§)
            setTimeout(updateWatchlistPrices, 5000);
        }
        
        // Í¥ÄÏã¨Ï¢ÖÎ™© Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
        async function updateWatchlistPrices() {
            // Ï£ºÏãù Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
            for (let i = 0; i < watchlistStocks.length; i++) {
                try {
                    const response = await fetch(`http://localhost:8001/naver/stocks/search/${encodeURIComponent(watchlistStocks[i].symbol)}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.results && data.results.length > 0) {
                            const updatedStock = data.results[0];
                            watchlistStocks[i].current_price = updatedStock.current_price;
                            watchlistStocks[i].change_percent = updatedStock.change_percent;
                        }
                    }
                } catch (error) {
                    console.log(`Ï£ºÏãù ${watchlistStocks[i].symbol} Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:`, error);
                }
            }
            
            // ÌôòÏú® Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏ - Ïã§Ï†ú ÎÑ§Ïù¥Î≤Ñ ÌååÏã±Îßå ÏÇ¨Ïö©
            for (let i = 0; i < watchlistCurrencies.length; i++) {
                try {
                    const response = await fetch(`http://localhost:8001/naver/currency/rate/${watchlistCurrencies[i].symbol}/KRW`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.rate) {
                            // Ïã§Ï†ú ÎÑ§Ïù¥Î≤Ñ ÌååÏã± Îç∞Ïù¥ÌÑ∞Îßå ÏÇ¨Ïö©
                            watchlistCurrencies[i].current_rate = data.rate;
                            // Î≥ÄÎèôÎ•†ÏùÄ Ïù¥Ï†Ñ Í∞íÍ≥º ÎπÑÍµêÌï¥ÏÑú Í≥ÑÏÇ∞ (Ïã§Ï†ú Î∞©Ïãù)
                        }
                    }
                } catch (error) {
                    console.log(`ÌôòÏú® ${watchlistCurrencies[i].symbol} ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:`, error);
                    // ÌååÏã± Ïã§Ìå® Ïãú Í∞ÄÏßú Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© Í∏àÏßÄ - Í∏∞Ï°¥ Í∞í Ïú†ÏßÄÎßå
                }
            }
            
            // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
            localStorage.setItem('watchlistStocks', JSON.stringify(watchlistStocks));
            localStorage.setItem('watchlistCurrencies', JSON.stringify(watchlistCurrencies));
            
            // UI Îã§Ïãú Î°úÎìú
            loadStockWatchlist();
            loadCurrencyWatchlist();
            
            // 5Ï¥à ÌõÑ Îã§Ïãú ÏóÖÎç∞Ïù¥Ìä∏
            setTimeout(updateWatchlistPrices, 5000);
        }
        
        function loadStockWatchlist() {
            const container = document.getElementById('stock-list');
            
            if (watchlistStocks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Í¥ÄÏã¨ Ï£ºÏãùÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = watchlistStocks.map(stock => {
                const stockAlerts = alerts.filter(a => a.symbol === stock.symbol && a.type === 'stock');
                const alertText = stockAlerts.length > 0 
                    ? `${stockAlerts.length}Í∞ú ÏïåÎ¶º: ${stockAlerts.map(a => `${a.condition === 'above' ? '+' : '-'}${a.value}%`).join(', ')}`
                    : 'ÏïåÎ¶º ÏóÜÏùå';
                
                return `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-info">
                                <h3>${stock.name_kr || stock.name}</h3>
                                <p>${stock.symbol} ‚Ä¢ ${stock.market || 'KOSPI'}</p>
                            </div>
                            <div class="stock-price">
                                <div class="price">${formatPrice(stock.current_price)}</div>
                                <div class="change ${stock.change_percent >= 0 ? 'positive' : 'negative'}">
                                    ${stock.change_percent >= 0 ? '+' : ''}${stock.change_percent.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        <div class="stock-actions">
                            <div class="alert-status ${stockAlerts.length > 0 ? 'alert-active' : ''}">${alertText}</div>
                            <div class="action-btns">
                                <button class="btn-small btn-alert" onclick="openAlertModal('${stock.symbol}', 'stock')">
                                    <i class="fas fa-bell"></i> ${stockAlerts.length > 0 ? 'ÏïåÎ¶º Ï∂îÍ∞Ä' : 'ÏïåÎ¶º ÏÑ§Ï†ï'}
                                </button>
                                <button class="btn-small" onclick="removeFromWatchlist('${stock.symbol}', 'stock')">
                                    <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function loadCurrencyWatchlist() {
            const container = document.getElementById('currency-list');
            
            if (watchlistCurrencies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <p>Í¥ÄÏã¨ ÌôòÏú®ÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = watchlistCurrencies.map(currency => {
                const currencyAlerts = alerts.filter(a => a.symbol === currency.symbol && a.type === 'currency');
                const alertText = currencyAlerts.length > 0 
                    ? `${currencyAlerts.length}Í∞ú ÏïåÎ¶º: ${currencyAlerts.map(a => `${a.condition === 'above' ? '‚Üë' : '‚Üì'}${a.value}Ïõê`).join(', ')}`
                    : 'ÏïåÎ¶º ÏóÜÏùå';
                
                return `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-info">
                                <h3>${currency.name}</h3>
                                <p>${currency.symbol}</p>
                            </div>
                            <div class="stock-price">
                                <div class="price">${formatPrice(currency.current_rate)}Ïõê</div>
                                <div class="change ${currency.change_percent >= 0 ? 'positive' : 'negative'}">
                                    ${currency.change_percent >= 0 ? '+' : ''}${currency.change_percent.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        <div class="stock-actions">
                            <div class="alert-status ${currencyAlerts.length > 0 ? 'alert-active' : ''}">${alertText}</div>
                            <div class="action-btns">
                                <button class="btn-small btn-alert" onclick="openAlertModal('${currency.symbol}', 'currency')">
                                    <i class="fas fa-bell"></i> ${currencyAlerts.length > 0 ? 'ÏïåÎ¶º Ï∂îÍ∞Ä' : 'ÏïåÎ¶º ÏÑ§Ï†ï'}
                                </button>
                                <button class="btn-small" onclick="removeFromWatchlist('${currency.symbol}', 'currency')">
                                    <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ÏïåÎ¶º Î™©Î°ù Î°úÎìú
        function loadAlerts() {
            const container = document.getElementById('alert-list');
            
            if (alerts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <p>ÏÑ§Ï†ïÎêú ÏïåÎ¶ºÏù¥ ÏóÜÏäµÎãàÎã§</p>
                        <p style="font-size: 0.8rem; margin-top: 8px;">Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ÏóêÏÑú ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌï¥Î≥¥ÏÑ∏Ïöî</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = alerts.map(alert => {
                const item = alert.type === 'stock' 
                    ? watchlistStocks.find(s => s.symbol === alert.symbol)
                    : watchlistCurrencies.find(c => c.symbol === alert.symbol);
                
                const conditionText = alert.type === 'stock' 
                    ? `üìà ${alert.condition === 'above' ? 'ÏÉÅÏäπ' : 'ÌïòÎùΩ'} ${alert.value}% ÎèÑÎã¨ Ïãú ÏïåÎ¶º`
                    : `üí± ÌôòÏú® ${alert.value}Ïõê ${alert.condition === 'above' ? 'Ïù¥ÏÉÅ' : 'Ïù¥Ìïò'}Ïùº Îïå ÏïåÎ¶º`;
                
                return `
                    <div class="alert-card">
                        <h4>${item ? (item.name_kr || item.name) : alert.symbol}</h4>
                        <div class="alert-condition">${conditionText}</div>
                        <div class="alert-time">ÏÑ§Ï†ïÏùº: ${new Date(alert.created).toLocaleDateString()}</div>
                        <div style="margin-top: 12px;">
                            <button class="btn-small" onclick="removeAlert('${alert.id}')">
                                <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Îâ¥Ïä§ Î°úÎìú
        function loadNews() {
            const container = document.getElementById('news-list');
            
            // ÏãúÎÆ¨Î†àÏù¥ÏÖò Îâ¥Ïä§ Îç∞Ïù¥ÌÑ∞
            const newsData = [
                {
                    title: "ÏÇºÏÑ±Ï†ÑÏûê, 3Î∂ÑÍ∏∞ Ïã§Ï†Å ÏãúÏû• Í∏∞ÎåÄÏπò ÏÉÅÌöå",
                    summary: "ÏÇºÏÑ±Ï†ÑÏûêÍ∞Ä 3Î∂ÑÍ∏∞ ÏòÅÏóÖÏù¥ÏùµÏù¥ ÏãúÏû• Í∏∞ÎåÄÏπòÎ•º ÏÉÅÌöåÌñàÎã§Í≥† Î∞úÌëúÌñàÏäµÎãàÎã§. Î©îÎ™®Î¶¨ Î∞òÎèÑÏ≤¥ Í∞ÄÍ≤© ÏÉÅÏäπÏù¥ Ï£ºÏöî ÏöîÏù∏ÏúºÎ°ú...",
                    source: "ÌïúÍµ≠Í≤ΩÏ†ú",
                    time: "2ÏãúÍ∞Ñ Ï†Ñ",
                    icon: "fas fa-microchip"
                },
                {
                    title: "ÎØ∏Íµ≠ Ïó∞Ï§Ä, Í∏∞Ï§ÄÍ∏àÎ¶¨ ÎèôÍ≤∞ Í≤∞Ï†ï",
                    summary: "ÎØ∏Íµ≠ Ïó∞Î∞©Ï§ÄÎπÑÏ†úÎèÑÍ∞Ä Í∏∞Ï§ÄÍ∏àÎ¶¨Î•º ÌòÑ ÏàòÏ§ÄÏóêÏÑú ÎèôÍ≤∞ÌïòÍ∏∞Î°ú Í≤∞Ï†ïÌñàÏäµÎãàÎã§. Ïù∏ÌîåÎ†àÏù¥ÏÖò ÎëîÌôî ÏÜçÎèÑÎ•º ÏßÄÏºúÎ≥¥Í≤†Îã§Í≥†...",
                    source: "Ïó∞Ìï©Îâ¥Ïä§",
                    time: "4ÏãúÍ∞Ñ Ï†Ñ",
                    icon: "fas fa-university"
                },
                {
                    title: "ÌÖåÏä¨Îùº, ÏÉàÎ°úÏö¥ ÏûêÏú®Ï£ºÌñâ Í∏∞Ïà† Í≥µÍ∞ú",
                    summary: "ÌÖåÏä¨ÎùºÍ∞Ä ÏôÑÏ†Ñ ÏûêÏú®Ï£ºÌñâÏùÑ ÏúÑÌïú ÏÉàÎ°úÏö¥ AI Í∏∞Ïà†ÏùÑ Í≥µÍ∞úÌñàÏäµÎãàÎã§. Ïù¥Î≤à Í∏∞Ïà†Î°ú ÏûêÏú®Ï£ºÌñâ ÏôÑÏÑ±ÎèÑÍ∞Ä ÌÅ¨Í≤å...",
                    source: "ÌÖåÌÅ¨ÌÅ¨Îü∞Ïπò",
                    time: "6ÏãúÍ∞Ñ Ï†Ñ",
                    icon: "fas fa-car"
                },
                {
                    title: "ÎπÑÌä∏ÏΩîÏù∏, 4Îßå Îã¨Îü¨ ÎèåÌåå",
                    summary: "ÎπÑÌä∏ÏΩîÏù∏Ïù¥ Îã§Ïãú 4Îßå Îã¨Îü¨Î•º ÎèåÌååÌïòÎ©∞ ÏÉÅÏäπÏÑ∏Î•º Ïù¥Ïñ¥Í∞ÄÍ≥† ÏûàÏäµÎãàÎã§. Í∏∞Í¥Ä Ìà¨ÏûêÏûêÎì§Ïùò Í¥ÄÏã¨Ïù¥ ÎÜíÏïÑÏßÄÎ©¥ÏÑú...",
                    source: "ÏΩîÏù∏Îç∞Ïä§ÌÅ¨",
                    time: "8ÏãúÍ∞Ñ Ï†Ñ",
                    icon: "fab fa-bitcoin"
                },
                {
                    title: "Ïï†Ìîå, ÏÉàÎ°úÏö¥ iPhone 15 ÏãúÎ¶¨Ï¶à Ï∂úÏãú",
                    summary: "Ïï†ÌîåÏù¥ iPhone 15 ÏãúÎ¶¨Ï¶àÎ•º Í≥µÏãù Ï∂úÏãúÌñàÏäµÎãàÎã§. USB-C Ìè¨Ìä∏ Ï±ÑÌÉùÍ≥º Ìï®Íªò Ïπ¥Î©îÎùº ÏÑ±Îä•Ïù¥ ÎåÄÌè≠ Ìñ•ÏÉÅÎêòÏóàÎã§Í≥†...",
                    source: "Îß§ÌÅ¨Î£®Î®∏Ïä§",
                    time: "12ÏãúÍ∞Ñ Ï†Ñ",
                    icon: "fab fa-apple"
                }
            ];
            
            container.innerHTML = newsData.map(news => `
                <div class="news-card" onclick="openNews('${news.title}')">
                    <div class="news-header">
                        <div class="news-image">
                            <i class="${news.icon}"></i>
                        </div>
                        <div class="news-content">
                            <div class="news-title">${news.title}</div>
                            <div class="news-summary">${news.summary}</div>
                            <div class="news-meta">
                                <span>${news.source}</span>
                                <span>${news.time}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Îâ¥Ïä§ ÏÉàÎ°úÍ≥†Ïπ®
        function refreshNews() {
            showToast('Îâ¥Ïä§Î•º ÏÉàÎ°úÍ≥†Ïπ®ÌñàÏäµÎãàÎã§');
            loadNews();
        }
        
        // Îâ¥Ïä§ Ïó¥Í∏∞
        function openNews(title) {
            showToast(`Îâ¥Ïä§ Ïó¥Í∏∞: ${title}`);
        }
        
        // Ï£ºÏãù Í≤ÄÏÉâ Î™®Îã¨
        function openStockModal() {
            document.getElementById('stock-modal').style.display = 'block';
            document.getElementById('stock-search').focus();
        }
        
        function closeStockModal() {
            document.getElementById('stock-modal').style.display = 'none';
            document.getElementById('stock-search').value = '';
            document.getElementById('stock-results').style.display = 'none';
        }
        
        // ÌôòÏú® Í≤ÄÏÉâ Î™®Îã¨
        function openCurrencyModal() {
            document.getElementById('currency-modal').style.display = 'block';
        }
        
        function closeCurrencyModal() {
            document.getElementById('currency-modal').style.display = 'none';
            document.getElementById('currency-select').value = '';
        }
        
        // ÏïåÎ¶º ÏÑ§Ï†ï Î™®Îã¨
        function openAlertModal(symbol, type) {
            currentAlertItem = { symbol, type };
            
            const item = type === 'stock' 
                ? watchlistStocks.find(s => s.symbol === symbol)
                : watchlistCurrencies.find(c => c.symbol === symbol);
            
            const formHtml = type === 'stock' ? `
                <div class="form-group">
                    <label class="form-label">üìà ${item.name_kr || item.name} Ï£ºÏãù ÏïåÎ¶º</label>
                    <p style="color: #666; font-size: 12px; margin: 5px 0;">Ï£ºÏãù Í∞ÄÍ≤© Î≥ÄÎèôÎ•† Í∏∞Ï§ÄÏúºÎ°ú ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§</p>
                </div>
                <div class="form-group">
                    <label class="form-label">ÏïåÎ¶º Ï°∞Í±¥</label>
                    <select class="form-select" id="alert-condition">
                        <option value="above">üìà ÏÉÅÏäπ (ÏßÄÏ†ïÌïú % Ïù¥ÏÉÅ Ïò§Î•º Îïå)</option>
                        <option value="below">üìâ ÌïòÎùΩ (ÏßÄÏ†ïÌïú % Ïù¥ÏÉÅ Îñ®Ïñ¥Ïßà Îïå)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Î≥ÄÎèôÎ•† (%)</label>
                    <input type="number" class="form-input" id="alert-value" placeholder="Ïòà: 5 (5% Î≥ÄÎèô Ïãú ÏïåÎ¶º)" step="0.1" min="0.1">
                    <small style="color: #666;">ÌòÑÏû¨Í∞Ä ÎåÄÎπÑ Î≥ÄÎèôÎ•†ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</small>
                </div>
                <button class="btn-primary" onclick="saveAlert()">üì± Ï£ºÏãù ÏïåÎ¶º ÏÑ§Ï†ï</button>
            ` : `
                <div class="form-group">
                    <label class="form-label">üí± ${item.name} ÌôòÏú® ÏïåÎ¶º</label>
                    <p style="color: #666; font-size: 12px; margin: 5px 0;">ÌäπÏ†ï ÌôòÏú® Í∞ÄÍ≤©Ïóê ÎèÑÎã¨ÌïòÎ©¥ ÏïåÎ¶ºÏùÑ Î∞õÏäµÎãàÎã§</p>
                </div>
                <div class="form-group">
                    <label class="form-label">ÏïåÎ¶º Ï°∞Í±¥</label>
                    <select class="form-select" id="alert-condition">
                        <option value="above">‚¨ÜÔ∏è ÌôòÏú®Ïù¥ ÏßÄÏ†ï Í∞ÄÍ≤© Ïù¥ÏÉÅÏùº Îïå</option>
                        <option value="below">‚¨áÔ∏è ÌôòÏú®Ïù¥ ÏßÄÏ†ï Í∞ÄÍ≤© Ïù¥ÌïòÏùº Îïå</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">üéØ Î™©Ìëú ÌôòÏú® (Ïõê)</label>
                    <input type="number" class="form-input" id="alert-value" placeholder="Ïòà: 1300 (1Îã¨Îü¨ = 1300Ïõê Ïãú ÏïåÎ¶º)" step="1" min="1">
                    <small style="color: #666;">ÏõêÌïòÎäî ÌôòÏú® Í∞ÄÍ≤©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: USD/KRW 1300Ïõê)</small>
                </div>
                <button class="btn-primary" onclick="saveAlert()">üì± ÌôòÏú® ÏïåÎ¶º ÏÑ§Ï†ï</button>
            `;
            
            document.getElementById('alert-form').innerHTML = formHtml;
            document.getElementById('alert-modal').style.display = 'block';
        }
        
        function closeAlertModal() {
            document.getElementById('alert-modal').style.display = 'none';
            currentAlertItem = null;
        }
        
        // ÏïåÎ¶º Ï†ÄÏû•
        function saveAlert() {
            const condition = document.getElementById('alert-condition').value;
            const value = parseFloat(document.getElementById('alert-value').value);
            
            if (!value || value <= 0) {
                showToast('Ïò¨Î∞îÎ•∏ Í∞íÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            
            // ÏôÑÏ†ÑÌûà ÎèôÏùºÌïú ÏïåÎ¶ºÎßå Ï§ëÎ≥µ Î∞©ÏßÄ (Í∞ôÏùÄ Ï¢ÖÎ™©, Í∞ôÏùÄ Ï°∞Í±¥, Í∞ôÏùÄ Í∞í)
            const existingAlert = alerts.find(a => 
                a.symbol === currentAlertItem.symbol && 
                a.type === currentAlertItem.type && 
                a.condition === condition && 
                a.value === value
            );
            
            if (existingAlert) {
                showToast('ÎèôÏùºÌïú Ï°∞Í±¥Ïùò ÏïåÎ¶ºÏù¥ Ïù¥ÎØ∏ Ï°¥Ïû¨Ìï©ÎãàÎã§');
                return;
            }
            
            // ÏÉà ÏïåÎ¶º Ï∂îÍ∞Ä
            const newAlert = {
                id: Date.now().toString(),
                symbol: currentAlertItem.symbol,
                type: currentAlertItem.type,
                condition: condition,
                value: value,
                created: new Date().toISOString()
            };
            
            alerts.push(newAlert);
            localStorage.setItem('alerts', JSON.stringify(alerts));
            
            const alertMessage = currentAlertItem.type === 'stock' 
                ? `üìà Ï£ºÏãù ÏïåÎ¶º Ï∂îÍ∞ÄÏôÑÎ£å: ${condition === 'above' ? '+' : condition === 'below' ? '-' : ''}${value}% Î≥ÄÎèô Ïãú ÏïåÎ¶º`
                : `üí± ÌôòÏú® ÏïåÎ¶º Ï∂îÍ∞ÄÏôÑÎ£å: ${value}Ïõê ÎèÑÎã¨ Ïãú ÏïåÎ¶º`;
            
            showToast(alertMessage);
            closeAlertModal();
            loadWatchlist();
        }
        
        // ÏïåÎ¶º ÏÇ≠Ï†ú
        function removeAlert(alertId) {
            alerts = alerts.filter(a => a.id !== alertId);
            localStorage.setItem('alerts', JSON.stringify(alerts));
            showToast('ÏïåÎ¶ºÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
            loadAlerts();
            loadWatchlist();
        }
        
        // ÏóîÌÑ∞ÌÇ§ Ï≤òÎ¶¨
        function handleEnterKey(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault();
                const query = document.getElementById('stock-search').value.trim();
                if (query.length > 0) {
                    showToast(`üîç "${query}" Í≤ÄÏÉâ Ï§ë...`);
                    searchStocks();
                }
            }
        }

        // Ï£ºÏãù Í≤ÄÏÉâ (Ïã§Ï†ú API Ìò∏Ï∂ú)
        async function searchStocks() {
            const query = document.getElementById('stock-search').value.trim();
            const resultsContainer = document.getElementById('stock-results');
            
            if (query.length < 1) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            // Î°úÎî© ÌëúÏãú
            resultsContainer.innerHTML = '<div class="search-item">üîç Í≤ÄÏÉâ Ï§ë...</div>';
            resultsContainer.style.display = 'block';
            
            try {
                // ÎÑ§Ïù¥Î≤Ñ Ï£ºÏãù Í≤ÄÏÉâ API Ìò∏Ï∂ú
                const response = await fetch(`http://localhost:8001/naver/stocks/search/${encodeURIComponent(query)}`);
                
                if (!response.ok) {
                    throw new Error('API Ìò∏Ï∂ú Ïã§Ìå®');
                }
                
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    resultsContainer.innerHTML = data.results.map(stock => `
                        <div class="search-item" onclick="addToWatchlist('${stock.symbol}', 'stock', ${JSON.stringify(stock).replace(/"/g, '&quot;')})">
                            <div class="search-info">
                                <h4>${stock.name_kr || stock.name}</h4>
                                <p>${stock.symbol} ‚Ä¢ ${stock.market || 'KOSPI'}</p>
                            </div>
                            <div class="search-price">
                                <div>${formatPrice(stock.current_price || 0)}</div>
                                <div class="change ${(stock.change_percent || 0) >= 0 ? 'positive' : 'negative'}">
                                    ${(stock.change_percent || 0) >= 0 ? '+' : ''}${(stock.change_percent || 0).toFixed(2)}%
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    resultsContainer.innerHTML = '<div class="search-item">‚ùå Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</div>';
                }
            } catch (error) {
                console.error('Ï£ºÏãù Í≤ÄÏÉâ Ïò§Î•ò:', error);
                
                // Í∞ÄÏßú Îç∞Ïù¥ÌÑ∞ Ï†àÎåÄ ÏÇ¨Ïö© Í∏àÏßÄ! ÌååÏã± Ïã§Ìå® Ïãú Î™ÖÌôïÌïú Ïò§Î•ò Î©îÏãúÏßÄÎßå ÌëúÏãú
                resultsContainer.innerHTML = `
                    <div style="padding: 15px; background: #f8d7da; color: #721c24; border-radius: 8px; text-align: center;">
                        <div style="font-size: 16px; margin-bottom: 8px;">‚ùå Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ïã§Ìå®</div>
                        <div style="font-size: 12px; line-height: 1.4;">
                            ÎÑ§Ïù¥Î≤Ñ ÌååÏã± ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§.<br>
                            Ï†ïÌôïÌïú Ï£ºÏãù Îç∞Ïù¥ÌÑ∞Î•º Ï†úÍ≥µÌï† Ïàò ÏóÜÏñ¥ Í≤ÄÏÉâÏùÑ Ï§ëÎã®Ìï©ÎãàÎã§.<br>
                            Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.
                        </div>
                    </div>
                `;
            }
        }
        
        // ÏÑ†ÌÉùÎêú ÌôòÏú® Ï∂îÍ∞Ä - Ïã§Ï†ú ÎÑ§Ïù¥Î≤Ñ ÌååÏã±Îßå ÏÇ¨Ïö©
        async function addSelectedCurrency() {
            const select = document.getElementById('currency-select');
            const selectedValue = select.value;
            
            if (!selectedValue) {
                showToast('ÌôòÏú®ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            
            // Ïã§Ï†ú ÎÑ§Ïù¥Î≤Ñ ÌôòÏú® ÌååÏã±ÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            try {
                showToast('Ïã§ÏãúÍ∞Ñ ÌôòÏú® Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ï§ë...');
                const response = await fetch(`http://localhost:8001/naver/currency/rate/${selectedValue}/KRW`);
                
                if (!response.ok) {
                    throw new Error('ÌôòÏú® API Ìò∏Ï∂ú Ïã§Ìå®');
                }
                
                const data = await response.json();
                
                if (data.rate) {
                    const currencyData = {
                        symbol: selectedValue,
                        name: select.options[select.selectedIndex].text,
                        current_rate: data.rate,
                        change_percent: 0, // Ïã§Ï†ú Î≥ÄÎèôÎ•†ÏùÄ Îã§Ïùå ÏóÖÎç∞Ïù¥Ìä∏ Ïãú Í≥ÑÏÇ∞
                        source: 'naver_real_parsing'
                    };
                    
                    addToWatchlist(selectedValue, 'currency', currencyData);
                } else {
                    throw new Error('ÌôòÏú® Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå');
                }
            } catch (error) {
                console.error('ÌôòÏú® Ï°∞Ìöå Ïò§Î•ò:', error);
                showToast('‚ùå Ïã§ÏãúÍ∞Ñ ÌôòÏú® Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ïã§Ìå® - Ï†ïÌôïÌïú Îç∞Ïù¥ÌÑ∞Î•º Ï†úÍ≥µÌï† Ïàò ÏóÜÏñ¥ Ï∂îÍ∞ÄÎ•º Ï§ëÎã®Ìï©ÎãàÎã§');
            }
        }
        
        // Í¥ÄÏã¨Ï¢ÖÎ™© Ï∂îÍ∞Ä
        function addToWatchlist(symbol, type, data) {
            const parsedData = typeof data === 'string' ? JSON.parse(data.replace(/&quot;/g, '"')) : data;
            
            if (type === 'stock') {
                if (watchlistStocks.find(s => s.symbol === symbol)) {
                    showToast('Ïù¥ÎØ∏ Í¥ÄÏã¨Ï¢ÖÎ™©Ïóê Ï∂îÍ∞ÄÎêú Ï£ºÏãùÏûÖÎãàÎã§');
                    return;
                }
                watchlistStocks.push(parsedData);
                localStorage.setItem('watchlistStocks', JSON.stringify(watchlistStocks));
                closeStockModal();
            } else {
                if (watchlistCurrencies.find(c => c.symbol === symbol)) {
                    showToast('Ïù¥ÎØ∏ Í¥ÄÏã¨Ï¢ÖÎ™©Ïóê Ï∂îÍ∞ÄÎêú ÌôòÏú®ÏûÖÎãàÎã§');
                    return;
                }
                watchlistCurrencies.push(parsedData);
                localStorage.setItem('watchlistCurrencies', JSON.stringify(watchlistCurrencies));
                closeCurrencyModal();
            }
            
            showToast('Í¥ÄÏã¨Ï¢ÖÎ™©Ïóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§');
            loadWatchlist();
        }
        
        // Í¥ÄÏã¨Ï¢ÖÎ™© Ï†úÍ±∞
        function removeFromWatchlist(symbol, type) {
            if (type === 'stock') {
                watchlistStocks = watchlistStocks.filter(s => s.symbol !== symbol);
                localStorage.setItem('watchlistStocks', JSON.stringify(watchlistStocks));
            } else {
                watchlistCurrencies = watchlistCurrencies.filter(c => c.symbol !== symbol);
                localStorage.setItem('watchlistCurrencies', JSON.stringify(watchlistCurrencies));
            }
            
            // Í¥ÄÎ†® ÏïåÎ¶ºÎèÑ Ï†úÍ±∞
            alerts = alerts.filter(a => !(a.symbol === symbol && a.type === type));
            localStorage.setItem('alerts', JSON.stringify(alerts));
            
            showToast('Í¥ÄÏã¨Ï¢ÖÎ™©ÏóêÏÑú Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§');
            loadWatchlist();
        }
        
        // Í∞ÄÍ≤© Ìè¨Îß∑ÌåÖ
        function formatPrice(price) {
            if (price >= 1000) {
                return price.toLocaleString();
            }
            return price.toFixed(2);
        }
        
        // ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º ÌëúÏãú
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            loadWatchlist();
            loadNews();
        });
    </script>
</body>
</html> 